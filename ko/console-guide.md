# Security > NHN Bastion > 콘솔 사용 가이드

## 시작하기

1. NHN Bastion을 사용하기 위해서는 가장 먼저 NHN Bastion 서비스를 활성화합니다.
2. NHN Bastion는 서비스 제공을 위하여 API 연동을 통한 사용자의 자원에 접근하는 권한이 필요합니다.

## NHN Bastion 생성

1. Security > NHN Bastion으로 이동합니다.
2. 각 항목을 선택하고 하단의 생성을 클릭합니다.
    * 이름 (필수) : 복수의 웹터미널을 이용하는 경우, 웹터미널을 구분하기 위한 이름
    * 타입 (필수) : 웹터미널의 인스턴스 성능
        * 성능 : 성능별 차이는 웹터미널이 동시에 생성할 수 있는 SSH 세션 수
    * VPC (필수) : 웹터미널에서 사용할 VPC
    * 서브넷 (필수) : 웹터미널에서 사용할 서브넷
    * 플로팅 IP (선택) : 웹터미널에서 사용할 플로팅 IP 사용 유무

```
[참고]
최초로 생성된 웹터미널은 서비스 비활성화시까지 스펙을 변경하거나 삭제할 수 없습니다.
인터넷 게이트웨이가 연결된 VPC에 한하여 플로팅 IP를 연결할 수 있습니다.
웹터미널에서 접속대상과의 SSH 통신을 허용해야 접속대상에 접근할 수 있습니다. ex)Security Group 등
```

## 인스턴스 연결

* <strong>[정책관리]</strong>에서 사용자에게 접근 허용된 인스턴스 리스트만 출력되며 접근이 허용된 인스턴스에 접근할 수 있습니다.

### 인스턴스 접근

1. 접근이 필요한 인스턴스의 **[연결]** 버튼을 클릭합니다.
2. 인스턴스 접근에 이용할 웹 터미널을 선택합니다.
3. 접근할 인스턴스의 IP가 복수일 경우 접근가능한 IP를 선택합니다.
4. 인증방식을 선택합니다.
    * SSH KEY 인증
        * 인스턴스의 OS 계정을 입력합니다.
        * 인스턴스 생성시 설정한 KEY를 업로드합니다.
    * 비밀번호 인증
        * 인스턴스의 OS 계정을 입력합니다.
        * 인스턴스의 비밀번호를 입력합니다.
    * 임시 SSH KEY 인증
        * 인스턴스의 OS계정을 입력합니다.

```
[주의]
인스턴스와 SSH 통신이 가능한 웹 터미널을 선택이 필요합니다.
비밀번호 인증은 OS에서 비밀번호 접근이 가능하도록 설정이 필요합니다.
임시 SSH KEY 인증은 스크립트를 복사한 웹 터미널을 통해서만 접근이 가능합니다.
```

## 사용자 관리

NHN Bastion 서비스에 권한이 있는 사용자 목록을 확인하고 사용자 그룹을 생성 및 관리할 수 있습니다.

### 사용자 목록

NHN Bastion 서비스를 이용할 권한을 가지고 있는 사용자 목록을 보여주며, 사용자의 권한 및 인스턴스 마지막 접근일시를 확인할 수 있습니다.

### 그룹

사용자 그룹을 생성 및 관리할 수 있으며, 생성한 그룹은 <strong>[정책관리]</strong>에서 접근주체로 등록할 수 있습니다.

## 정책관리

서비스 대상에 등록된 인스턴스를 대상으로 접근통제정책 및 명령어 통제 정책을 설정할 수 있습니다.
각 정책에는 우선순위가 있으며 우선순위가 높은 정책이 적용됩니다.

```
[예시]
아래의 [표]와 같이 정책이 적용되어 있는 경우,
 User A는 Instance A 접근가능, "shutdown" 명령어만 사용불가, 그외 명령어 사용가능
 User A는 Instance B 접근가능, "cd" 명령어만 사용가능, 그외 명령어 사용불가
 User B는 Instance A 접근가능, "reboot" 명령어만 사용불가, 그외 명령어 사용가능
 User B는 Instance B 접근불가
 
```

| 우선순위 | 사용자 | 접근대상 | 명령어 정책 |
| ---- | --- | ---- | ------ |
| #1 | user A | Instance A | [금지] shutdown |
| #2 | user A | Instance A, Instance B | [허용] cd |
| #3 | user B | Instance A | [금지] reboot |

### 정책생성

* 정책생성 미지
* 이름 : 정책명의 이름을 입력할 수 있습니다.
* 설명 : 정책에 대한 설명을 입력할 수 있습니다.
* 사용자 및 그룹 : 사용자 및 사용자 그룹을 접근 주체로 등록할 수 있습니다.
* 자원 및 자원그룹 :
    * 모든자원 : 서비스 대상에 추가된 자원을 모두 접근 대상으로 등록합니다.
    * 자원선택 : 인스턴스, 오토스케일링 그룹, 자원그룹을 접근 대상으로 등록할 수 있습니다.
* 명령어 통제 정책
    * 허용 : 등록된 명령어만 사용이 가능합니다. (화이트리스트 방식)
    * 금지 : 등록된 명령어의 사용을 차단합니다. (블랙리스트 방식)

    ```
    [주의]
    아래의 명령어에 대해서는 명령어 정책 등록 유무와 관계없이 모두 차단됩니다.
    우회차단 명령어 : SSH, TELNET, SFTP, RCP, SCP, FTP, RSAP, RLOGIN 등
    ```


### 순서변경

* 정책의 우선순위를 변경할 수 있습니다.
* "모달 이미지"
    1. 선택한 정책을 원하는 우선순위로 변경하고, **[수정]** 버튼을 클릭합니다.
    2. **[순서 변경 후]** 에서 우선순위가 변경했을 경우의 우선순위를 변경하는 정책기준으로 위/아래 정책과 함께 미리보기로 제공합니다.
    3. 변경된 우선순위를 확인 후 **[저장]** 버튼을 클릭하여 정책의 우선순위를 변경합니다.

### 정책관리

* 수정 : 선택한 정책의 내용을 수정할 수 있습니다.
* 복사 : 선택한 정책을 복사할 수 있습니다.
* 삭제 : 선택한 정책을 삭제할 수 있습니다.
* 상세보기 : 선택한 정책의 세부 내용을 확인할 수 있습니다.

## 자원관리

### 인스턴스 관리

**[자원관리] > [인스턴스 관리]** 탭에서는 프로젝트 내에 등록되어 있는 인스턴스를 서비스 대상으로 추가할 수 있습니다.
등록된 인스턴스를 대상으로 접근통제 정책 및 명령어 통제 정책 기능을 제공합니다.

* 추가
    * "이미지"
    * 프로젝트내에 존재하는 인스턴스를 선택하여 서비스 대상으로 추가할 수 있습니다.
* 삭제
    * 선택한 인스턴스를 서비스 대상에서 삭제할 수 있습니다.
* 전체 삭제
    * 등록된 모든 인스턴스를 서비스 대상에서 삭제할 수 있습니다.
* 자동 등록
    * 프로젝트내에 존재하는 모든 인스턴스가 자동으로 서비스 대상에 추가됩니다.
    * 인스턴스 생성/삭제 시에도 자동으로 반영되어 서비스 대상으로 추가됩니다.

    ```
    [주의]
    인스턴스 생성/삭제에 대한 변경사항은 최대 5분뒤에 반영될 수 있습니다.
    ```
* 자원관리
    * "이미지"
    * 선택한 인스턴스의 세션타임아웃을 변경할 수 있습니다.
        * 기본 설정 : 환경설정에 적용되어 있는 세션타임아웃
    * 선택한 인스턴스의 접속포트를 변경할 수 있습니다.
        * 기본 설정 : 환경설정에 적용되어 있는 접속포트

### 웹터미널 관리

**[자원관리] > [웹 터미널 관리]** 인스턴스 접근에 필요한 터미널과 베스천을 제공하는 역할의 웹 터미널 인스턴스를 생성/관리할 수 있습니다.

* 생성
    * 이름 (필수) : 복수의 웹터미널을 이용하는 경우, 웹터미널을 구분하기 위한 이름
    * 타입 (필수) : 웹터미널의 인스턴스 성능
        * 성능 : 성능별 차이는 웹터미널이 동시에 생성할 수 있는 SSH 세션 수
    * VPC (필수) : 웹터미널에서 사용할 VPC
    * 서브넷 (필수) : 웹터미널에서 사용할 서브넷
    * 플로팅 IP (선택) : 웹터미널에서 사용할 플로팅 IP 사용 유무
* 삭제
    * 선택한 웹터미널을 삭제할 수 있습니다.

    ```
    [주의]
    서비스 활성화 시 최초로 생성된 웹터미널은 삭제할 수 없습니다. 삭제를 원하는 경우 서비스 비활성화를 통하여 삭제할 수 있습니다.
    ```
* 플로팅 IP 관리
    * "이미지"
    * 웹 터미널의 플로팅 IP 사용 유무를 설정할 수 있습니다.
    * Network Firewall 서비스를 이용하여 공인 IP를 DNAT처리하는 고객은 리다이렉션 기능을 통하여 공인 IP를 입력할 수 있습니다.
    * 사내 DNS를 이용하는 고객은 리다이렉션 기능을 통하여 도메인 주소를 입력할 수 있습니다.
* IP 접근제어
    * "이미지"
    * 웹 터미널에 접근 가능이 필요한 CIDR을 입력할 수 있습니다.

    ```
    [참고]
    IP 접근제어는 Whitelist 방식으로 제공됩니다.
    ```
* 스크립트
    * "이미지"
    * 임시 SSH KEY를 접근방식을 이용하기 위하여 대상 인스턴스에서 실행해야 하는 스크립트를 제공합니다.

    ```
    [주의]
    * 임시 SSH KEY 접근방식은 선택한 웹 터미널을 이용하여 접근하는 경우에만 적용되며, 다른 경로를 통한 접근 시에는 제공되지 않습니다.
    ```

### 자원 그룹

**[자원관리] > [자원그룹]** 탭에서는 서비스 대상에 등록되어 있는 인스턴스 그룹을 생성 및 관리 할 수 있습니다.

* "이미지"
* 그룹생성
    * 서비스 대상에 등록되어 있는 인스턴스 추가/삭제하여 그룹을 생성할 수 있습니다.
* 복사
    * 생성된 자원그룹을 복사 할 수 있습니다.
* 수정
    * 생성된 자원그룹을 수정할 수 있습니다.
* 삭제
    * 선택한 자원그룹을 삭제할 수 있습니다.

## 이력관리

NHN Bastion 서비스를 이용해 인스턴스에 접근한 이력을 관리할 수 있습니다. 
이력은 **최대 6개월간 보관**되며 이 후 보관을 원하시면 <strong>[환경설정]-[로그관리]</strong>를 통하여 OBS에 백업할 수 있습니다.

### 실시간 세션

실시간으로 인스턴스와 연결되어 있는 세션을 확인할 수 있으며, 연결을 차단할 수 있습니다.

* 차단 : 연결되어 있는 사용자 세션을 차단합니다.
* 보기 : 연결되어 있는 사용자 세션의 상세정보를 확인할 수 있습니다.

### 사용자 접근이력

사용자가 인스턴스에 접근한 이력을 확인할 수 있으며, 검색조건과 접속시간을 이용하여 원하는 이력을 조회할 수 있습니다.

* 상세보기
    * 기본정보 : 선택한 이력의 세션정보를 확인할 수 있습니다.
    * 로그 : 선택한 이력의 세션에서 사용한 명령어 이력을 확인할 수 있습니다.

### 명령어 사용이력

사용자가 사용한 명령어를 확인할 수 있으며, 검색조건과 접속시간을 이용하여 원하는 명령어 이력을 조회할 수 있습니다.

* 명령어 등록
    * 주요한 명령어를 등록하여 편리하게 해당 명령어 사용이력을 조회할 수 있습니다.
* 상세보기
    * 기본정보 : 선택한 이력의 세션정보를 확인할 수 있습니다.
    * 로그 : 선택한 이력의 세션에서 사용한 명령어 이력을 확인할 수 있습니다.

## 환경설정

### 세션타임아웃

인스턴스 접근시에 웹터미널에서 제공하는 세션타임아웃을 설정할 수 있습니다.

```
[참고]
웹 터미널에서 제공하는 세션타임아웃 설정이므로, OS에서 설정한 세션타임아웃과는 별개로 동작합니다.
```

### 최대연결설정

사용자가 동시에 연결할 수 있는 최대세션 수를 설정할 수 있습니다.

### 로그관리

NHN Bastion 서비스에서 제공하는 로그를 고객의 OBS에 백업할 수 있습니다.

### 접속포트관리

인스턴스 접근에 사용되는 SSH Port를 지정할 수 있습니다.

```
[참고]
웹 터미널에서 접근대상 인스턴스로 연결 시 이용하는 Port로, OS에서 설정한 SSH Port로 설정해야 합니다.
```

### 서비스 비활성화

NHN Bastion 서비스에서 생성된 모든 자원을 삭제하며, 서비스는 초기화 됩니다.

```
[주의]
NHN Bastion 서비스를 이용 중 생성된 데이터와 서비스 내에 모든 리소스가 삭제되며, 삭제된 정보는 복구할 수 없습니다.
```
